<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
<title>r/Place Clone</title>
<style>
html, body {margin:0;padding:0;overflow:hidden;font-family:Arial,sans-serif;}
#toolbar {
    position: fixed;top:0;left:0;right:0;height:50px;
    background: #fff;border-bottom:1px solid #ccc;
    display:flex;align-items:center;padding:0 10px;z-index:1000;
}
#toolbar .color {width:20px;height:20px;margin:0 2px;border:1px solid #ccc;cursor:pointer;}
#toolbar .color.active {border:2px solid black;}
#toolbar button {margin:0 5px;padding:5px 10px;cursor:pointer;}
#toolbar #cooldown {margin-left:auto;font-size:14px;}
#canvasContainer {position:absolute;top:50px;left:0;right:0;bottom:0;overflow:hidden;background:#f0f0f0;}
#canvas {display:block;transform-origin:0 0;}
#zoomInfo {position:fixed;bottom:10px;right:10px;background:rgba(255,255,255,0.8);padding:4px 6px;border-radius:4px;font-size:12px;}
</style>
</head>
<body>

<div id="toolbar">
    <button id="drawBtn">Draw</button>
    <button id="panBtn">Pan</button>
    <div id="colors"></div>
    <div id="cooldown">Ready</div>
</div>
<div id="canvasContainer">
    <canvas id="canvas" width="5000" height="5000"></canvas>
</div>
<div id="zoomInfo">Zoom: 100%</div>

<script>
const FIREBASE_DB_URL = 'https://drawing-ce2f6-default-rtdb.firebaseio.com';
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const colorsDiv = document.getElementById('colors');
const cooldownEl = document.getElementById('cooldown');
const zoomInfo = document.getElementById('zoomInfo');

const colors = ['#FF0000','#00FF00','#0000FF','#FFFF00','#FF00FF','#00FFFF','#FFA500','#800080','#FFC0CB','#A52A2A','#808080','#000000','#FFFFFF','#008000','#000080','#800000'];
let currentColor = colors[0];

colors.forEach(c=>{
    const div=document.createElement('div');
    div.className='color'+(c===currentColor?' active':'');
    div.style.background=c;
    div.addEventListener('click',()=>{currentColor=c;document.querySelectorAll('#colors .color').forEach(b=>b.classList.remove('active')); div.classList.add('active');});
    colorsDiv.appendChild(div);
});

// Tools
let tool='draw';
document.getElementById('drawBtn').addEventListener('click',()=>{tool='draw';canvas.style.cursor='crosshair';});
document.getElementById('panBtn').addEventListener('click',()=>{tool='pan';canvas.style.cursor='grab';});

// Transform
let scale=1,tx=0,ty=0;
function updateTransform(){canvas.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`;zoomInfo.textContent=`Zoom: ${Math.round(scale*100)}%`;}
updateTransform();

// Mouse handling
let isDrawing=false,isPanning=false,px,py;
canvas.addEventListener('mousedown',e=>{
    const rect=canvas.getBoundingClientRect();
    const x=(e.clientX-rect.left)/scale;
    const y=(e.clientY-rect.top)/scale;
    if(tool==='draw'){isDrawing=true;px=x;py=y;placePixel(Math.floor(x),Math.floor(y));}
    else if(tool==='pan'){isPanning=true;px=e.clientX-tx;py=e.clientY-ty;canvas.style.cursor='grabbing';}
});
canvas.addEventListener('mousemove',e=>{
    const rect=canvas.getBoundingClientRect();
    if(isDrawing){const x=(e.clientX-rect.left)/scale;const y=(e.clientY-rect.top)/scale;px=x;py=y;}
    if(isPanning){tx=e.clientX-px;ty=e.clientY-py;updateTransform();}
});
canvas.addEventListener('mouseup',()=>{isDrawing=false;isPanning=false;canvas.style.cursor=tool==='draw'?'crosshair':'grab';});

// Zoom
canvas.addEventListener('wheel',e=>{
    e.preventDefault();
    const rect=canvas.getBoundingClientRect();
    const mx=e.clientX-rect.left,my=e.clientY-rect.top;
    const factor=e.deltaY>0?0.9:1.1;
    const newScale=Math.min(Math.max(0.1,scale*factor),10);
    tx=mx-(mx-tx)*(newScale/scale);
    ty=my-(my-ty)*(newScale/scale);
    scale=newScale;
    updateTransform();
},{passive:false});

// Firebase pixel placement
let lastPlaced=0;
let placeInterval=300000; // 5 min default
const adminIP='69.170.112.226';
async function checkAdmin(){try{const resp=await fetch('https://api.ipify.org?format=json');const ip=(await resp.json()).ip;if(ip===adminIP){placeInterval=1000;cooldownEl.textContent='Admin Mode';}}catch{}}
checkAdmin();

async function placePixel(x,y){
    const now=Date.now();
    if(now-lastPlaced<placeInterval) return;
    lastPlaced=now;
    ctx.fillStyle=currentColor;
    ctx.fillRect(x,y,1,1);
    try{
        await fetch(FIREBASE_DB_URL+'/pixels/'+x+'_'+y+'.json',{
            method:'PUT',headers:{'Content-Type':'application/json'},
            body:JSON.stringify({x,y,color:currentColor,timestamp:Date.now()})
        });
    }catch(err){console.error(err);}
}

// Cooldown display
setInterval(()=>{
    const remaining=Math.max(0,placeInterval-(Date.now()-lastPlaced));
    cooldownEl.textContent=remaining<=0?'Ready':'Cooldown: '+Math.ceil(remaining/1000)+'s';
},1000);

// Load pixels
async function loadPixels(){
    try{
        const resp=await fetch(FIREBASE_DB_URL+'/pixels.json');
        const data=await resp.json();
        if(data){Object.values(data).forEach(p=>{ctx.fillStyle=p.color;ctx.fillRect(p.x,p.y,1,1);});}
    }catch{}
}
loadPixels();

// Realtime updates
setInterval(loadPixels,3000);

</script>
</body>
</html>
